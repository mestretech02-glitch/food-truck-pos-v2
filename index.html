<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Food Truck Manager</title>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
            color: #fff;
            min-height: 100vh;
        }

        .header {
            background: linear-gradient(90deg, #ff6b35 0%, #f7931e 100%);
            padding: 20px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.3);
            display: flex;
            align-items: center;
            justify-content: space-between;
        }

        .header h1 {
            font-size: 28px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .nav-tabs {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }

        .nav-tabs button {
            background: rgba(255, 255, 255, 0.2);
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 14px;
            transition: all 0.3s;
        }

        .nav-tabs button.active {
            background: #ff6b35;
            color: white;
        }

        .nav-tabs button:hover {
            background: #ff6b35;
        }

        .container {
            max-width: 1400px;
            margin: 20px auto;
            padding: 0 20px;
        }

        .content {
            display: none;
        }

        .content.active {
            display: block;
        }

        .two-column {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-bottom: 20px;
        }

        .card {
            background: #0f3460;
            border: 2px solid #ff6b35;
            border-radius: 10px;
            padding: 20px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.3);
        }

        .card h2 {
            color: #ff6b35;
            margin-bottom: 15px;
            font-size: 20px;
        }

        .form-group {
            margin-bottom: 15px;
        }

        .form-group label {
            display: block;
            color: #ff6b35;
            margin-bottom: 5px;
            font-weight: bold;
        }

        .form-group input,
        .form-group textarea,
        .form-group select {
            width: 100%;
            padding: 10px;
            background: #1a1a2e;
            border: 1px solid #ff6b35;
            border-radius: 5px;
            color: white;
            font-family: inherit;
        }

        .form-group textarea {
            resize: vertical;
            min-height: 80px;
        }

        .button-group {
            display: flex;
            gap: 10px;
            margin-top: 20px;
        }

        button {
            flex: 1;
            padding: 12px;
            border: none;
            border-radius: 5px;
            font-size: 16px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s;
        }

        .btn-primary {
            background: #ff6b35;
            color: white;
        }

        .btn-primary:hover {
            background: #f7931e;
            transform: translateY(-2px);
        }

        .btn-secondary {
            background: #0f3460;
            color: #ff6b35;
            border: 2px solid #ff6b35;
        }

        .btn-secondary:hover {
            background: #ff6b35;
            color: white;
        }

        .btn-danger {
            background: #d32f2f;
            color: white;
        }

        .btn-danger:hover {
            background: #b71c1c;
        }

        .product-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
            gap: 15px;
            margin-bottom: 20px;
        }

        .product-card {
            background: #1a1a2e;
            border: 2px solid #ff6b35;
            border-radius: 8px;
            padding: 15px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s;
        }

        .product-card:hover {
            background: #ff6b35;
            color: white;
            transform: translateY(-5px);
        }

        .product-card h3 {
            color: #ff6b35;
            font-size: 16px;
            margin-bottom: 10px;
        }

        .product-card .price {
            color: #4caf50;
            font-size: 18px;
            font-weight: bold;
        }

        .product-card:hover h3,
        .product-card:hover .price {
            color: white;
        }

        .cart-item {
            background: #1a1a2e;
            border-left: 4px solid #ff6b35;
            padding: 12px;
            margin-bottom: 10px;
            border-radius: 5px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .cart-item-info {
            flex: 1;
        }

        .cart-item-name {
            color: #ff6b35;
            font-weight: bold;
        }

        .cart-item-price {
            color: #4caf50;
        }

        .cart-item-controls {
            display: flex;
            gap: 5px;
            align-items: center;
        }

        .cart-item-controls input {
            width: 50px;
            padding: 5px;
            background: #0f3460;
            border: 1px solid #ff6b35;
            border-radius: 3px;
            color: white;
            text-align: center;
        }

        .cart-item-controls button {
            padding: 5px 10px;
            font-size: 12px;
        }

        .cart-total {
            background: #0f3460;
            border: 2px solid #4caf50;
            padding: 15px;
            border-radius: 8px;
            text-align: right;
            margin: 20px 0;
        }

        .cart-total h3 {
            color: #4caf50;
            font-size: 24px;
        }

        .type-selector {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
            margin-bottom: 15px;
        }

        .type-selector button {
            padding: 10px;
            background: #0f3460;
            border: 2px solid #ff6b35;
            color: #ff6b35;
            border-radius: 5px;
            cursor: pointer;
            transition: all 0.3s;
        }

        .type-selector button.selected {
            background: #ff6b35;
            color: white;
        }

        .list-item {
            background: #1a1a2e;
            border-left: 4px solid #ff6b35;
            padding: 15px;
            margin-bottom: 10px;
            border-radius: 5px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .list-item-info h3 {
            color: #ff6b35;
            margin-bottom: 5px;
        }

        .list-item-info p {
            color: #ccc;
            font-size: 14px;
        }

        .list-item-actions {
            display: flex;
            gap: 10px;
        }

        .list-item-actions button {
            padding: 8px 12px;
            font-size: 12px;
        }

        .empty-state {
            text-align: center;
            padding: 40px;
            color: #999;
        }

        .empty-state-icon {
            font-size: 48px;
            margin-bottom: 10px;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-bottom: 20px;
        }

        .stat-card {
            background: #0f3460;
            border: 2px solid #ff6b35;
            border-radius: 8px;
            padding: 20px;
            text-align: center;
        }

        .stat-card h3 {
            color: #ff6b35;
            margin-bottom: 10px;
        }

        .stat-card .value {
            color: #4caf50;
            font-size: 28px;
            font-weight: bold;
        }

        @media (max-width: 768px) {
            .two-column {
                grid-template-columns: 1fr;
            }

            .nav-tabs {
                flex-direction: column;
            }

            .nav-tabs button {
                width: 100%;
            }

            .product-grid {
                grid-template-columns: repeat(auto-fill, minmax(120px, 1fr));
            }
        }
    </style>
</head>
<body>
    <div class="header">
        <h1>üçî Food Truck Manager</h1>
        <div class="nav-tabs">
            <button class="tab-btn active" data-tab="vendas">Vendas</button>
            <button class="tab-btn" data-tab="cozinha">üë®‚Äçüç≥ Cozinha</button>
            <button class="tab-btn" data-tab="clientes">üë• Clientes</button>
            <button class="tab-btn" data-tab="produtos">üçΩÔ∏è Produtos</button>
            <button class="tab-btn" data-tab="combos">üéÅ Combos</button>
            <button class="tab-btn" data-tab="estoque">üì¶ Estoque</button>
            <button class="tab-btn" data-tab="despesas">üí∞ Despesas</button>
            <button class="tab-btn" data-tab="perdicio">üóëÔ∏è Perd√≠cio</button>
            <button class="tab-btn" data-tab="relatorios">üìà Relat√≥rios</button>
            <button class="tab-btn" data-tab="configuracoes">‚öôÔ∏è Configura√ß√µes</button>
        </div>
    </div>

    <div class="container">
        <!-- ABA VENDAS -->
        <div id="vendas" class="content active">
            <div class="two-column">
                <div class="card">
                    <h2>üçΩÔ∏è Produtos Dispon√≠veis</h2>
                    <div id="productsList" class="product-grid"></div>
                </div>

                <div class="card">
                    <h2>üõí Carrinho de Compras</h2>
                    
                    <div class="form-group">
                        <label>Tipo de Pedido</label>
                        <div class="type-selector">
                            <button class="type-btn" data-type="para-viagem">Para Viagem</button>
                            <button class="type-btn selected" data-type="local">Local</button>
                        </div>
                    </div>

                    <div class="form-group">
                        <label>Origem</label>
                        <div class="type-selector">
                            <button class="origin-btn selected" data-origin="venda-local">Venda Local</button>
                            <button class="origin-btn" data-origin="ifoods">iFoods</button>
                        </div>
                    </div>

                    <div class="form-group">
                        <label>Nome do Cliente</label>
                        <input type="text" id="clientName" placeholder="Buscar ou Adicionar Cliente">
                    </div>

                    <div class="form-group">
                        <label>WhatsApp (Opcional)</label>
                        <input type="text" id="clientWhatsapp" placeholder="N√∫mero do WhatsApp">
                    </div>

                    <div id="cartItems" style="max-height: 300px; overflow-y: auto;"></div>

                    <div class="cart-total">
                        <h3>Total: R$ <span id="cartTotal">0.00</span></h3>
                    </div>

                    <button class="btn-primary" onclick="finalizarVenda()">‚úì Finalizar Venda</button>
                </div>
            </div>
        </div>

        <!-- ABA COZINHA -->
        <div id="cozinha" class="content">
            <div class="card">
                <h2>üë®‚Äçüç≥ Pedidos Pendentes</h2>
                <div id="kitchenOrders"></div>
            </div>
        </div>

        <!-- ABA CLIENTES -->
        <div id="clientes" class="content">
            <div class="two-column">
                <div class="card">
                    <h2>Novo Cliente</h2>
                    <div class="form-group">
                        <label>Nome</label>
                        <input type="text" id="newClientName" placeholder="Nome do cliente">
                    </div>
                    <div class="form-group">
                        <label>Telefone</label>
                        <input type="text" id="newClientPhone" placeholder="Telefone">
                    </div>
                    <div class="form-group">
                        <label>Email</label>
                        <input type="email" id="newClientEmail" placeholder="Email">
                    </div>
                    <button class="btn-primary" onclick="adicionarCliente()">Adicionar Cliente</button>
                </div>

                <div class="card">
                    <h2>Lista de Clientes</h2>
                    <div id="clientsList"></div>
                </div>
            </div>
        </div>

        <!-- ABA PRODUTOS -->
        <div id="produtos" class="content">
            <div class="two-column">
                <div class="card">
                    <h2>Novo Produto</h2>
                    <div class="form-group">
                        <label>Nome</label>
                        <input type="text" id="newProductName" placeholder="Nome do produto">
                    </div>
                    <div class="form-group">
                        <label>Pre√ßo</label>
                        <input type="number" id="newProductPrice" placeholder="Pre√ßo" step="0.01">
                    </div>
                    <div class="form-group">
                        <label>Descri√ß√£o</label>
                        <textarea id="newProductDesc" placeholder="Descri√ß√£o"></textarea>
                    </div>
                    <div class="form-group">
                        <label>Categoria</label>
                        <select id="newProductCategory">
                            <option value="Hamburguer">Hamburguer</option>
                            <option value="Bebida">Bebida</option>
                            <option value="Acompanhamento">Acompanhamento</option>
                            <option value="Sobremesa">Sobremesa</option>
                        </select>
                    </div>
                    <div class="button-group">
                        <button class="btn-primary" onclick="adicionarProduto()">Salvar</button>
                        <button class="btn-secondary" onclick="limparFormularioProduto()">Cancelar</button>
                    </div>
                </div>

                <div class="card">
                    <h2>Lista de Produtos</h2>
                    <div id="productsList2"></div>
                </div>
            </div>
        </div>

        <!-- ABA ESTOQUE -->
        <div id="estoque" class="content">
            <div class="two-column">
                <div class="card">
                    <h2>Novo Ingrediente</h2>
                    <div class="form-group">
                        <label>Nome</label>
                        <input type="text" id="newIngredientName" placeholder="Nome do ingrediente">
                    </div>
                    <div class="form-group">
                        <label>Quantidade</label>
                        <input type="number" id="newIngredientQty" placeholder="Quantidade" step="0.01">
                    </div>
                    <div class="form-group">
                        <label>Unidade</label>
                        <select id="newIngredientUnit">
                            <option value="kg">kg</option>
                            <option value="L">L</option>
                            <option value="un">un</option>
                            <option value="g">g</option>
                        </select>
                    </div>
                    <button class="btn-primary" onclick="adicionarIngrediente()">Adicionar</button>
                </div>

                <div class="card">
                    <h2>Estoque Atual</h2>
                    <div id="inventoryList"></div>
                </div>
            </div>
        </div>

        <!-- ABA DESPESAS -->
        <div id="despesas" class="content">
            <div class="two-column">
                <div class="card">
                    <h2>Nova Despesa</h2>
                    <div class="form-group">
                        <label>Descri√ß√£o</label>
                        <input type="text" id="expenseDesc" placeholder="Descri√ß√£o da despesa">
                    </div>
                    <div class="form-group">
                        <label>Valor</label>
                        <input type="number" id="expenseValue" placeholder="Valor" step="0.01">
                    </div>
                    <div class="form-group">
                        <label>Categoria</label>
                        <select id="expenseCategory">
                            <option value="Alimentos">Alimentos</option>
                            <option value="Combust√≠vel">Combust√≠vel</option>
                            <option value="Manuten√ß√£o">Manuten√ß√£o</option>
                            <option value="Outros">Outros</option>
                        </select>
                    </div>
                    <button class="btn-primary" onclick="adicionarDespesa()">Registrar</button>
                </div>

                <div class="card">
                    <h2>Despesas do Dia</h2>
                    <div id="expensesList"></div>
                </div>
            </div>
        </div>

        <!-- ABA RELAT√ìRIOS -->
        <div id="relatorios" class="content">
            <div class="stats-grid" id="statsGrid"></div>
            <div class="card">
                <h2>Vendas do Dia</h2>
                <div id="salesList"></div>
            </div>
        </div>

        <!-- ABA CONFIGURA√á√ïES -->
        <div id="configuracoes" class="content">
            <div class="card">
                <h2>Configura√ß√µes da Loja</h2>
                <div class="form-group">
                    <label>Nome da Loja</label>
                    <input type="text" id="storeName" placeholder="Nome da loja">
                </div>
                <div class="form-group">
                    <label>Telefone</label>
                    <input type="text" id="storePhone" placeholder="Telefone">
                </div>
                <div class="form-group">
                    <label>Email</label>
                    <input type="email" id="storeEmail" placeholder="Email">
                </div>
                <button class="btn-primary" onclick="salvarConfigura√ß√µes()">Salvar Configura√ß√µes</button>
            </div>
        </div>
    </div>

    <script>
        // Inicializar Supabase
        const SUPABASE_URL = 'https://nnpifmbfwyraptfksjwo.supabase.co';
        const SUPABASE_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im5ucGlmbWJmd3lyYXB0ZmtzandvIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjE1ODE5NjYsImV4cCI6MjA3NzE1Nzk2Nn0.QTmxkS8DylHG0VIZBsNVsolsgfnImwuu_jmsBp7xR_Q';

        const { createClient } = window.supabase;
        const supabase = createClient(SUPABASE_URL, SUPABASE_KEY);

        // Dados locais
        let cart = [];
        let products = [];
        let clients = [];
        let inventory = [];
        let expenses = [];
        let orders = [];
        let selectedOrderType = 'local';
        let selectedOrigin = 'venda-local';

        // Carregar dados ao iniciar
        async function loadData() {
            try {
                // Carregar produtos
                const { data: productsData } = await supabase.from('products').select('*');
                if (productsData) products = productsData;
                
                // Carregar clientes
                const { data: clientsData } = await supabase.from('clients').select('*');
                if (clientsData) clients = clientsData;
                
                // Carregar estoque
                const { data: inventoryData } = await supabase.from('inventory').select('*');
                if (inventoryData) inventory = inventoryData;
                
                // Carregar despesas
                const { data: expensesData } = await supabase.from('expenses').select('*');
                if (expensesData) expenses = expensesData;
                
                // Carregar pedidos
                const { data: ordersData } = await supabase.from('orders').select('*');
                if (ordersData) orders = ordersData;
            } catch (error) {
                console.log('Usando dados locais (Supabase n√£o dispon√≠vel)');
                // Usar dados locais se Supabase n√£o estiver dispon√≠vel
            }

            renderProducts();
            renderProductsList();
            renderClientsList();
            renderInventory();
            renderExpenses();
            renderKitchenOrders();
            renderStats();
        }

        // Abas
        document.querySelectorAll('.tab-btn').forEach(btn => {
            btn.addEventListener('click', () => {
                document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
                document.querySelectorAll('.content').forEach(c => c.classList.remove('active'));
                btn.classList.add('active');
                document.getElementById(btn.dataset.tab).classList.add('active');
            });
        });

        // Seletores de tipo
        document.querySelectorAll('.type-btn').forEach(btn => {
            btn.addEventListener('click', () => {
                document.querySelectorAll('.type-btn').forEach(b => b.classList.remove('selected'));
                btn.classList.add('selected');
                selectedOrderType = btn.dataset.type;
            });
        });

        document.querySelectorAll('.origin-btn').forEach(btn => {
            btn.addEventListener('click', () => {
                document.querySelectorAll('.origin-btn').forEach(b => b.classList.remove('selected'));
                btn.classList.add('selected');
                selectedOrigin = btn.dataset.origin;
            });
        });

        // Renderizar produtos
        function renderProducts() {
            const list = document.getElementById('productsList');
            if (products.length === 0) {
                list.innerHTML = '<div class="empty-state"><div class="empty-state-icon">üì≠</div>Nenhum produto cadastrado</div>';
                return;
            }

            list.innerHTML = products.map(p => `
                <div class="product-card" onclick="adicionarAoCarrinho(${p.id}, '${p.name}', ${p.price})">
                    <h3>${p.name}</h3>
                    <p class="price">R$ ${parseFloat(p.price).toFixed(2)}</p>
                </div>
            `).join('');
        }

        function renderProductsList() {
            const list = document.getElementById('productsList2');
            if (products.length === 0) {
                list.innerHTML = '<div class="empty-state">Nenhum produto cadastrado</div>';
                return;
            }

            list.innerHTML = products.map(p => `
                <div class="list-item">
                    <div class="list-item-info">
                        <h3>${p.name}</h3>
                        <p>R$ ${parseFloat(p.price).toFixed(2)}</p>
                    </div>
                    <div class="list-item-actions">
                        <button class="btn-danger" onclick="deletarProduto(${p.id})">Deletar</button>
                    </div>
                </div>
            `).join('');
        }

        // Adicionar ao carrinho
        function adicionarAoCarrinho(id, name, price) {
            const existing = cart.find(item => item.id === id);
            if (existing) {
                existing.quantity++;
            } else {
                cart.push({ id, name, price, quantity: 1 });
            }
            renderCart();
        }

        function renderCart() {
            const cartDiv = document.getElementById('cartItems');
            if (cart.length === 0) {
                cartDiv.innerHTML = '<p style="text-align: center; color: #999;">Selecione produtos para adicionar ao carrinho.</p>';
            } else {
                cartDiv.innerHTML = cart.map((item, idx) => `
                    <div class="cart-item">
                        <div class="cart-item-info">
                            <div class="cart-item-name">${item.name}</div>
                            <div class="cart-item-price">R$ ${(item.price * item.quantity).toFixed(2)}</div>
                        </div>
                        <div class="cart-item-controls">
                            <input type="number" value="${item.quantity}" onchange="alterarQuantidade(${idx}, this.value)">
                            <button class="btn-danger" onclick="removerDoCarrinho(${idx})">‚úï</button>
                        </div>
                    </div>
                `).join('');
            }
            atualizarTotal();
        }

        function alterarQuantidade(idx, qty) {
            cart[idx].quantity = parseInt(qty) || 1;
            renderCart();
        }

        function removerDoCarrinho(idx) {
            cart.splice(idx, 1);
            renderCart();
        }

        function atualizarTotal() {
            const total = cart.reduce((sum, item) => sum + (item.price * item.quantity), 0);
            document.getElementById('cartTotal').textContent = total.toFixed(2);
        }

        // Finalizar venda
        async function finalizarVenda() {
            if (cart.length === 0) {
                alert('Carrinho vazio!');
                return;
            }

            const clientName = document.getElementById('clientName').value || 'Cliente An√¥nimo';
            const clientWhatsapp = document.getElementById('clientWhatsapp').value || '';
            const total = cart.reduce((sum, item) => sum + (item.price * item.quantity), 0);

            const order = {
                client_name: clientName,
                client_whatsapp: clientWhatsapp,
                order_type: selectedOrderType,
                origin: selectedOrigin,
                items: cart,
                total: total,
                status: 'pendente',
                created_at: new Date().toISOString()
            };

            try {
                const { error } = await supabase.from('orders').insert([order]);
                if (error) throw error;
            } catch (error) {
                console.log('Salvando localmente');
            }

            orders.push(order);
            cart = [];
            document.getElementById('clientName').value = '';
            document.getElementById('clientWhatsapp').value = '';
            renderCart();
            renderKitchenOrders();
            alert('Venda finalizada com sucesso!');
        }

        // Produtos
        async function adicionarProduto() {
            const name = document.getElementById('newProductName').value;
            const price = document.getElementById('newProductPrice').value;
            const desc = document.getElementById('newProductDesc').value;
            const category = document.getElementById('newProductCategory').value;

            if (!name || !price) {
                alert('Preencha os campos obrigat√≥rios');
                return;
            }

            const product = { name, price: parseFloat(price), description: desc, category };

            try {
                const { data } = await supabase.from('products').insert([product]).select();
                if (data) products.push(data[0]);
            } catch (error) {
                console.log('Salvando localmente');
                product.id = Date.now();
                products.push(product);
            }

            limparFormularioProduto();
            renderProducts();
            renderProductsList();
        }

        function limparFormularioProduto() {
            document.getElementById('newProductName').value = '';
            document.getElementById('newProductPrice').value = '';
            document.getElementById('newProductDesc').value = '';
        }

        async function deletarProduto(id) {
            if (!confirm('Deletar produto?')) return;
            try {
                await supabase.from('products').delete().eq('id', id);
            } catch (error) {
                console.log('Deletando localmente');
            }
            products = products.filter(p => p.id !== id);
            renderProducts();
            renderProductsList();
        }

        // Clientes
        async function adicionarCliente() {
            const name = document.getElementById('newClientName').value;
            const phone = document.getElementById('newClientPhone').value;
            const email = document.getElementById('newClientEmail').value;

            if (!name) {
                alert('Preencha o nome');
                return;
            }

            const client = { name, phone, email };

            try {
                const { data } = await supabase.from('clients').insert([client]).select();
                if (data) clients.push(data[0]);
            } catch (error) {
                console.log('Salvando localmente');
                client.id = Date.now();
                clients.push(client);
            }

            document.getElementById('newClientName').value = '';
            document.getElementById('newClientPhone').value = '';
            document.getElementById('newClientEmail').value = '';
            renderClientsList();
        }

        function renderClientsList() {
            const list = document.getElementById('clientsList');
            if (clients.length === 0) {
                list.innerHTML = '<div class="empty-state">Nenhum cliente cadastrado</div>';
                return;
            }

            list.innerHTML = clients.map(c => `
                <div class="list-item">
                    <div class="list-item-info">
                        <h3>${c.name}</h3>
                        <p>${c.phone || 'Sem telefone'}</p>
                    </div>
                </div>
            `).join('');
        }

        // Estoque
        async function adicionarIngrediente() {
            const name = document.getElementById('newIngredientName').value;
            const qty = document.getElementById('newIngredientQty').value;
            const unit = document.getElementById('newIngredientUnit').value;

            if (!name || !qty) {
                alert('Preencha os campos');
                return;
            }

            const ingredient = { name, quantity: parseFloat(qty), unit };

            try {
                const { data } = await supabase.from('inventory').insert([ingredient]).select();
                if (data) inventory.push(data[0]);
            } catch (error) {
                console.log('Salvando localmente');
                ingredient.id = Date.now();
                inventory.push(ingredient);
            }

            document.getElementById('newIngredientName').value = '';
            document.getElementById('newIngredientQty').value = '';
            renderInventory();
        }

        function renderInventory() {
            const list = document.getElementById('inventoryList');
            if (inventory.length === 0) {
                list.innerHTML = '<div class="empty-state">Nenhum ingrediente cadastrado</div>';
                return;
            }

            list.innerHTML = inventory.map(i => `
                <div class="list-item">
                    <div class="list-item-info">
                        <h3>${i.name}</h3>
                        <p>${i.quantity} ${i.unit}</p>
                    </div>
                </div>
            `).join('');
        }

        // Despesas
        async function adicionarDespesa() {
            const desc = document.getElementById('expenseDesc').value;
            const value = document.getElementById('expenseValue').value;
            const category = document.getElementById('expenseCategory').value;

            if (!desc || !value) {
                alert('Preencha os campos');
                return;
            }

            const expense = { description: desc, value: parseFloat(value), category, created_at: new Date().toISOString() };

            try {
                const { data } = await supabase.from('expenses').insert([expense]).select();
                if (data) expenses.push(data[0]);
            } catch (error) {
                console.log('Salvando localmente');
                expense.id = Date.now();
                expenses.push(expense);
            }

            document.getElementById('expenseDesc').value = '';
            document.getElementById('expenseValue').value = '';
            renderExpenses();
        }

        function renderExpenses() {
            const list = document.getElementById('expensesList');
            const today = new Date().toDateString();
            const todayExpenses = expenses.filter(e => new Date(e.created_at).toDateString() === today);

            if (todayExpenses.length === 0) {
                list.innerHTML = '<div class="empty-state">Nenhuma despesa registrada</div>';
                return;
            }

            list.innerHTML = todayExpenses.map(e => `
                <div class="list-item">
                    <div class="list-item-info">
                        <h3>${e.description}</h3>
                        <p>${e.category}</p>
                    </div>
                    <div style="color: #d32f2f; font-weight: bold;">R$ ${parseFloat(e.value).toFixed(2)}</div>
                </div>
            `).join('');
        }

        // Cozinha
        function renderKitchenOrders() {
            const list = document.getElementById('kitchenOrders');
            const pendingOrders = orders.filter(o => o.status === 'pendente');

            if (pendingOrders.length === 0) {
                list.innerHTML = '<div class="empty-state"><div class="empty-state-icon">‚úì</div>Nenhum pedido pendente</div>';
                return;
            }

            list.innerHTML = pendingOrders.map((order, idx) => `
                <div class="list-item">
                    <div class="list-item-info">
                        <h3>${order.client_name}</h3>
                        <p>${order.items.map(i => `${i.quantity}x ${i.name}`).join(', ')}</p>
                    </div>
                    <div class="list-item-actions">
                        <button class="btn-primary" onclick="marcarPronto(${idx})">Pronto</button>
                    </div>
                </div>
            `).join('');
        }

        function marcarPronto(idx) {
            if (orders[idx]) {
                orders[idx].status = 'pronto';
                renderKitchenOrders();
            }
        }

        // Relat√≥rios
        function renderStats() {
            const today = new Date().toDateString();
            const todayOrders = orders.filter(o => new Date(o.created_at).toDateString() === today);
            const todayExpenses = expenses.filter(e => new Date(e.created_at).toDateString() === today);

            const totalSales = todayOrders.reduce((sum, o) => sum + o.total, 0);
            const totalExpenses = todayExpenses.reduce((sum, e) => sum + e.value, 0);
            const profit = totalSales - totalExpenses;

            document.getElementById('statsGrid').innerHTML = `
                <div class="stat-card">
                    <h3>Vendas do Dia</h3>
                    <div class="value">R$ ${totalSales.toFixed(2)}</div>
                </div>
                <div class="stat-card">
                    <h3>Despesas</h3>
                    <div class="value">R$ ${totalExpenses.toFixed(2)}</div>
                </div>
                <div class="stat-card">
                    <h3>Lucro</h3>
                    <div class="value" style="color: ${profit >= 0 ? '#4caf50' : '#d32f2f'};">R$ ${profit.toFixed(2)}</div>
                </div>
                <div class="stat-card">
                    <h3>Pedidos</h3>
                    <div class="value">${todayOrders.length}</div>
                </div>
            `;

            const salesList = document.getElementById('salesList');
            if (todayOrders.length === 0) {
                salesList.innerHTML = '<div class="empty-state">Nenhuma venda hoje</div>';
            } else {
                salesList.innerHTML = todayOrders.map(o => `
                    <div class="list-item">
                        <div class="list-item-info">
                            <h3>${o.client_name}</h3>
                            <p>${o.items.length} item(ns)</p>
                        </div>
                        <div style="color: #4caf50; font-weight: bold;">R$ ${o.total.toFixed(2)}</div>
                    </div>
                `).join('');
            }
        }

        // Configura√ß√µes
        function salvarConfigura√ß√µes() {
            const storeName = document.getElementById('storeName').value;
            const storePhone = document.getElementById('storePhone').value;
            const storeEmail = document.getElementById('storeEmail').value;

            localStorage.setItem('storeName', storeName);
            localStorage.setItem('storePhone', storePhone);
            localStorage.setItem('storeEmail', storeEmail);

            alert('Configura√ß√µes salvas!');
        }

        // Carregar dados ao iniciar
        loadData();
    </script>
</body>
</html>
