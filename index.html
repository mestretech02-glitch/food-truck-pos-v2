<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Food Truck Manager Pro</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.min.js"></script>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { background: #0f172a; color: #e2e8f0; font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; }
        .navbar { background: linear-gradient(135deg, #1e293b 0%, #0f172a 100%); border-bottom: 3px solid #ff8c00; padding: 1rem 2rem; display: flex; gap: 1rem; align-items: center; flex-wrap: wrap; }
        .navbar button { padding: 0.5rem 1rem; border: none; border-radius: 0.5rem; cursor: pointer; font-weight: 600; transition: all 0.3s; font-size: 0.9rem; }
        .navbar button.active { background: #ff8c00; color: white; }
        .navbar button:not(.active) { background: #334155; color: #cbd5e1; }
        .navbar button:hover { transform: translateY(-2px); }
        .container { padding: 2rem; }
        .card { background: #1e293b; border-radius: 1rem; padding: 1.5rem; margin-bottom: 1rem; border-left: 4px solid #ff8c00; }
        .modal { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.8); z-index: 1000; justify-content: center; align-items: center; }
        .modal.active { display: flex; }
        .modal-content { background: #1e293b; border-radius: 1rem; padding: 2rem; max-width: 600px; width: 90%; border: 2px solid #ff8c00; max-height: 85vh; overflow-y: auto; }
        .modal-title { font-size: 1.5rem; font-weight: bold; color: #ff8c00; margin-bottom: 1rem; }
        .option-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 1rem; margin: 1.5rem 0; }
        .option-item { background: #0f172a; padding: 1rem; border-radius: 0.5rem; border: 2px solid #334155; cursor: pointer; transition: all 0.3s; display: flex; align-items: center; gap: 0.75rem; }
        .option-item:hover { border-color: #ff8c00; background: #1a2332; }
        .option-item input[type="checkbox"] { cursor: pointer; width: 18px; height: 18px; accent-color: #ff8c00; }
        .option-label { flex: 1; }
        .option-price { color: #22c55e; font-weight: bold; font-size: 0.9rem; }
        .btn-primary { background: #ff8c00; color: white; padding: 0.75rem 1.5rem; border: none; border-radius: 0.5rem; cursor: pointer; font-weight: 600; transition: all 0.3s; }
        .btn-primary:hover { background: #e67e00; transform: translateY(-2px); }
        .btn-secondary { background: #64748b; color: white; padding: 0.75rem 1.5rem; border: none; border-radius: 0.5rem; cursor: pointer; font-weight: 600; }
        .btn-secondary:hover { background: #475569; }
        .btn-danger { background: #ef4444; color: white; padding: 0.5rem 1rem; border: none; border-radius: 0.5rem; cursor: pointer; }
        .btn-danger:hover { background: #dc2626; }
        .product-card { background: #1e293b; border: 2px solid #334155; padding: 1.5rem; border-radius: 0.75rem; cursor: pointer; transition: all 0.3s; margin-bottom: 1rem; }
        .product-card:hover { border-color: #ff8c00; transform: translateY(-2px); }
        .product-name { font-size: 1.1rem; font-weight: 600; margin-bottom: 0.5rem; }
        .product-price { color: #ff8c00; font-size: 1.2rem; font-weight: bold; }
        .cart-item { background: #0f172a; padding: 1rem; border-radius: 0.5rem; margin-bottom: 0.5rem; border-left: 3px solid #ff8c00; }
        .cart-item-name { font-weight: 600; margin-bottom: 0.25rem; }
        .cart-item-options { color: #fbbf24; font-size: 0.9rem; margin-left: 1rem; }
        .total-box { background: linear-gradient(135deg, #1e293b 0%, #0f172a 100%); border: 2px solid #22c55e; padding: 1rem; border-radius: 0.75rem; margin-top: 1rem; }
        .total-value { color: #22c55e; font-size: 1.5rem; font-weight: bold; }
        .grid-2 { display: grid; grid-template-columns: 1fr 1fr; gap: 2rem; }
        .section-title { font-size: 1.3rem; font-weight: bold; color: #ff8c00; margin-bottom: 1rem; }
        table { width: 100%; border-collapse: collapse; }
        th { background: #334155; padding: 0.75rem; text-align: left; font-weight: 600; border-bottom: 2px solid #ff8c00; color: #ffffff; }
        td { padding: 0.75rem; border-bottom: 1px solid #334155; color: #ffffff; }
        tr:hover { background: #1e293b; }
        textarea { width: 100%; padding: 0.75rem; background: #0f172a; border: 1px solid #334155; border-radius: 0.5rem; color: white; margin: 1rem 0; font-family: inherit; }
        textarea::placeholder { color: #64748b; }
        input[type="text"], input[type="number"], input[type="tel"], select { width: 100%; padding: 0.75rem; background: #0f172a; border: 1px solid #334155; border-radius: 0.5rem; color: white; margin-bottom: 1rem; }
        input::placeholder { color: #64748b; }
        select { cursor: pointer; }
        @media (max-width: 768px) {
            .grid-2 { grid-template-columns: 1fr; }
            .navbar { padding: 1rem; }
            .navbar button { padding: 0.4rem 0.8rem; font-size: 0.8rem; }
        }
    </style>
</head>
<body>
    <!-- NAVBAR -->
    <div class="navbar">
        <span style="font-size: 1.5rem; font-weight: bold; color: #ff8c00;">üçî Food Truck Manager</span>
        <button class="active" onclick="mostrarSecao('dashboard')">üìä Dashboard</button>
        <button onclick="mostrarSecao('vendas')">üõí Vendas</button>
        <button onclick="mostrarSecao('combos')">üéÅ Combos</button>
        <button onclick="mostrarSecao('cozinha')">üë®‚Äçüç≥ Cozinha</button>
        <button onclick="mostrarSecao('produtos')">üì¶ Produtos</button>
        <button onclick="mostrarSecao('estoque')">üìã Estoque</button>
        <button onclick="mostrarSecao('despesas')">üí∞ Despesas</button>
        <button onclick="mostrarSecao('relatorios')">üìä Relat√≥rios</button>
    </div>

    <!-- DASHBOARD -->
    <div id="dashboard" class="container" style="display: none;">
        <h1 class="section-title">üìä Dashboard</h1>
        <div class="grid-2">
            <div class="card">
                <div style="color: #ff8c00;">Faturamento</div>
                <div style="font-size: 2rem; font-weight: bold; color: #ff8c00;" id="dashFaturamento">R$ 0,00</div>
            </div>
            <div class="card">
                <div style="color: #22c55e;">Lucro L√≠quido</div>
                <div style="font-size: 2rem; font-weight: bold; color: #22c55e;" id="dashLucro">R$ 0,00</div>
            </div>
        </div>
        <div class="card">
            <div class="section-title">üìã Hist√≥rico de Vendas</div>
            <table>
                <thead>
                    <tr>
                        <th>#</th>
                        <th>Cliente</th>
                        <th>Total</th>
                        <th>Hora</th>
                    </tr>
                </thead>
                <tbody id="dashHistorico">
                    <tr><td colspan="4" style="text-align: center;">Nenhuma venda</td></tr>
                </tbody>
            </table>
        </div>
    </div>

    <!-- VENDAS -->
    <div id="vendas" class="container" style="display: none;">
        <h1 class="section-title">üõí Vendas</h1>
        <div class="grid-2">
            <div>
                <h2 style="color: #ff8c00; margin-bottom: 1rem;">üì¶ Produtos</h2>
                <div id="produtosVendas"></div>
            </div>
            <div>
                <h2 style="color: #ff8c00; margin-bottom: 1rem;">üõí Carrinho</h2>
                <div style="margin-bottom: 1rem;">
                    <input type="text" id="nomeCliente" placeholder="Nome do Cliente">
                    <input type="tel" id="telefoneCliente" placeholder="Telefone (11 99999-9999)">
                </div>
                <div id="carrinhoItems"></div>
                <div class="total-box">
                    <div>Total:</div>
                    <div class="total-value" id="carrinhoTotal">R$ 0,00</div>
                </div>
                <button class="btn-primary" onclick="finalizarVenda()" style="width: 100%; margin-top: 1rem;">Finalizar Venda</button>
            </div>
        </div>
    </div>

    <!-- COMBOS -->
    <div id="combos" class="container" style="display: none;">
        <h1 class="section-title">üéÅ Combos</h1>
        <button class="btn-primary" onclick="abrirModal('modalCombos')" style="margin-bottom: 1rem;">+ Novo Combo</button>
        <table>
            <thead>
                <tr>
                    <th>Nome</th>
                    <th>Produtos</th>
                    <th>Pre√ßo</th>
                    <th>A√ß√µes</th>
                </tr>
            </thead>
            <tbody id="combosTabela">
                <tr><td colspan="4" style="text-align: center;">Nenhum combo cadastrado</td></tr>
            </tbody>
        </table>
    </div>

    <!-- COZINHA -->
    <div id="cozinha" class="container" style="display: none;">
        <h1 class="section-title">üë®‚Äçüç≥ Cozinha</h1>
        <div id="cozinhaItems"></div>
    </div>

    <!-- PRODUTOS -->
    <div id="produtos" class="container" style="display: none;">
        <h1 class="section-title">üì¶ Produtos</h1>
        <button class="btn-primary" onclick="abrirModal('modalProduto')" style="margin-bottom: 1rem;">+ Novo Produto</button>
        <table>
            <thead>
                <tr>
                    <th>Nome</th>
                    <th>Pre√ßo</th>
                    <th>A√ß√µes</th>
                </tr>
            </thead>
            <tbody id="produtosTabela">
                <tr><td colspan="3" style="text-align: center;">Nenhum produto</td></tr>
            </tbody>
        </table>
    </div>

    <!-- ESTOQUE -->
    <div id="estoque" class="container" style="display: none;">
        <h1 class="section-title">üìã Estoque</h1>
        <button class="btn-primary" onclick="abrirModal('modalEstoque')" style="margin-bottom: 1rem;">+ Novo Ingrediente</button>
        <table>
            <thead>
                <tr>
                    <th>Ingrediente</th>
                    <th>Quantidade</th>
                    <th>Unidade</th>
                    <th>A√ß√µes</th>
                </tr>
            </thead>
            <tbody id="estoqueTabela">
                <tr><td colspan="4" style="text-align: center;">Nenhum ingrediente</td></tr>
            </tbody>
        </table>
    </div>

    <!-- DESPESAS -->
    <div id="despesas" class="container" style="display: none;">
        <h1 class="section-title">üí∞ Despesas</h1>
        <button class="btn-primary" onclick="abrirModal('modalDespesa')" style="margin-bottom: 1rem;">+ Novo Ingrediente</button>
        <table>
            <thead>
                <tr>
                    <th>Ingrediente</th>
                    <th>Quantidade</th>
                    <th>Unidade</th>
                    <th>Valor Pago</th>
                    <th>Custo Unit√°rio</th>
                    <th>A√ß√µes</th>
                </tr>
            </thead>
            <tbody id="despesasTable">
                <tr><td colspan="6" style="text-align: center;">Nenhum ingrediente cadastrado</td></tr>
            </tbody>
        </table>
    </div>

    <!-- RELAT√ìRIOS -->
    <div id="relatorios" class="container" style="display: none;">
        <h1 class="section-title">üìä Relat√≥rios</h1>
        <div style="margin-bottom: 1rem; display: flex; gap: 10px;">
            <button class="btn-primary" onclick="exportarPDF()" style="background: #10b981;">üì• Baixar PDF</button>
            <button class="btn-primary" onclick="exportarExcel()" style="background: #3b82f6;">üìä Baixar Excel</button>
        </div>
        <table>
            <thead>
                <tr>
                    <th>#</th>
                    <th>Cliente</th>
                    <th>Telefone</th>
                    <th>Produtos</th>
                    <th>Total</th>
                    <th>Hora</th>
                </tr>
            </thead>
            <tbody id="relatoriosTabela">
                <tr><td colspan="6" style="text-align: center;">Nenhuma venda</td></tr>
            </tbody>
        </table>
    </div>

    <!-- MODAIS -->
    <div id="modalPagamento" class="modal">
        <div class="modal-content" style="text-align: center;">
            <div class="modal-title">M√©todo de Pagamento</div>
            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1rem; margin: 2rem 0;">
                <button class="btn-primary" onclick="finalizarComPagamento('Dinheiro')" style="background: #10b981; padding: 2rem;">üíµ Dinheiro</button>
                <button class="btn-primary" onclick="finalizarComPagamento('D√©bito')" style="background: #3b82f6; padding: 2rem;">üèß D√©bito</button>
                <button class="btn-primary" onclick="finalizarComPagamento('Cr√©dito')" style="background: #f59e0b; padding: 2rem;">üí≥ Cr√©dito</button>
                <button class="btn-primary" onclick="finalizarComPagamento('PIX')" style="background: #8b5cf6; padding: 2rem;">üì± PIX</button>
            </div>
            <button class="btn-secondary" onclick="fecharModal('modalPagamento')" style="width: 100%;">Cancelar</button>
        </div>
    </div>

    <div id="modalSucesso" class="modal">
        <div class="modal-content" style="text-align: center;">
            <div style="font-size: 3rem; margin-bottom: 1rem;">‚úì</div>
            <div class="modal-title">Venda Realizada!</div>
            <div id="sucessoMsg" style="margin: 1rem 0; color: #cbd5e1;"></div>
            <button class="btn-primary" onclick="fecharModal('modalSucesso'); mostrarSecao('vendas'); limparCarrinho();" style="width: 100%;">OK</button>
        </div>
    </div>

    <div id="modalPersonalizacao" class="modal">
        <div class="modal-content">
            <div class="modal-title" id="modalPersonalizacaoTitle">Personalizar Produto</div>
            <div id="opcoesContainer"></div>
            <textarea id="observacoes" placeholder="Observa√ß√µes Adicionais:" style="margin-top: 1rem;"></textarea>
            <div style="display: flex; gap: 1rem; margin-top: 1rem;">
                <button class="btn-secondary" onclick="fecharModal('modalPersonalizacao')" style="flex: 1;">Cancelar</button>
                <button class="btn-primary" onclick="salvarPersonalizacao()" style="flex: 1;">Salvar Altera√ß√µes</button>
            </div>
        </div>
    </div>

    <div id="modalProduto" class="modal">
        <div class="modal-content">
            <div class="modal-title">Novo Produto</div>
            <input type="text" id="nomeProduto" placeholder="Nome do Produto">
            <input type="number" id="precoProduto" placeholder="Pre√ßo" step="0.01">
            <div style="display: flex; gap: 1rem;">
                <button class="btn-secondary" onclick="fecharModal('modalProduto')" style="flex: 1;">Cancelar</button>
                <button class="btn-primary" onclick="adicionarProduto()" style="flex: 1;">Salvar</button>
            </div>
        </div>
    </div>

    <div id="modalEstoque" class="modal">
        <div class="modal-content">
            <div class="modal-title">Novo Ingrediente</div>
            <input type="text" id="nomeIngrediente" placeholder="Nome do Ingrediente">
            <input type="number" id="quantidadeIngrediente" placeholder="Quantidade" step="0.01">
            <input type="text" id="unidadeIngrediente" placeholder="Unidade (kg, L, un)">
            <div style="display: flex; gap: 1rem;">
                <button class="btn-secondary" onclick="fecharModal('modalEstoque')" style="flex: 1;">Cancelar</button>
                <button class="btn-primary" onclick="adicionarIngrediente()" style="flex: 1;">Salvar</button>
            </div>
        </div>
    </div>

    <div id="modalDespesa" class="modal">
        <div class="modal-content">
            <div class="modal-title">Nova Despesa</div>
            <input type="text" id="nomeDespesa" placeholder="Nome do Ingrediente">
            <input type="number" id="quantidadeDespesa" placeholder="Quantidade" step="0.01">
            <input type="text" id="unidadeDespesa" placeholder="Unidade (kg, L, un)">
            <input type="number" id="valorDespesa" placeholder="Valor Pago" step="0.01">
            <div style="display: flex; gap: 1rem;">
                <button class="btn-secondary" onclick="fecharModal('modalDespesa')" style="flex: 1;">Cancelar</button>
                <button class="btn-primary" onclick="adicionarDespesa()" style="flex: 1;">Salvar</button>
            </div>
        </div>
    </div>

    <div id="modalCombos" class="modal">
        <div class="modal-content">
            <div class="modal-title">Novo Combo</div>
            <input type="text" id="nomeCombo" placeholder="Nome do Combo">
            <input type="number" id="precoCombo" placeholder="Pre√ßo" step="0.01">
            <textarea id="produtosCombo" placeholder="Produtos (separados por v√≠rgula)"></textarea>
            <div style="display: flex; gap: 1rem;">
                <button class="btn-secondary" onclick="fecharModal('modalCombos')" style="flex: 1;">Cancelar</button>
                <button class="btn-primary" onclick="adicionarCombo()" style="flex: 1;">Salvar</button>
            </div>
        </div>
    </div>

    <script>
        let dados = {
            produtos: [],
            combos: [],
            carrinho: [],
            vendas: [],
            pedidos: [],
            estoque: [],
            despesas: [],
            opcoes: []
        };

        let produtoSelecionado = null;

        function carregarDados() {
            try {
                const saved = localStorage.getItem('foodTruckData');
                if (saved) {
                    dados = JSON.parse(saved);
                }
            } catch (e) {
                console.error('Erro ao carregar dados:', e);
            }
            if (!dados.opcoes || dados.opcoes.length === 0) {
                dados.opcoes = [
                    { id: 1, nome: 'Sem Queijo', preco: 0 },
                    { id: 2, nome: 'Com Queijo', preco: 0 },
                    { id: 3, nome: 'Queijo Extra', preco: 3 },
                    { id: 4, nome: 'Bacon Extra', preco: 4 },
                    { id: 5, nome: 'Maionese Temperada', preco: 2 },
                    { id: 6, nome: 'Farofa', preco: 1.50 },
                    { id: 7, nome: 'Alface', preco: 0 },
                    { id: 8, nome: 'Tomate', preco: 0 }
                ];
            }
            if (!dados.produtos || dados.produtos.length === 0) {
                dados.produtos = [
                    { id: 1, nome: 'Hamburguer Cl√°ssico', preco: 25 },
                    { id: 2, nome: 'Hamburguer Especial', preco: 35 },
                    { id: 3, nome: 'Sandu√≠che de Frango', preco: 28 }
                ];
            }
            salvarDados();
        }

        function salvarDados() {
            localStorage.setItem('foodTruckData', JSON.stringify(dados));
        }

        function mostrarSecao(secao) {
            document.querySelectorAll('[id]').forEach(el => {
                if (['dashboard', 'vendas', 'combos', 'cozinha', 'produtos', 'estoque', 'despesas', 'relatorios'].includes(el.id)) {
                    el.style.display = 'none';
                }
            });
            document.getElementById(secao).style.display = 'block';
            document.querySelectorAll('.navbar button').forEach(btn => btn.classList.remove('active'));
            event.target.classList.add('active');
            atualizarUI();
        }

        function abrirModal(id) {
            document.getElementById(id).classList.add('active');
        }

        function fecharModal(id) {
            document.getElementById(id).classList.remove('active');
        }

        function adicionarProdutoAoCarrinho(produtoId) {
            produtoSelecionado = dados.produtos.find(p => p.id === produtoId);
            document.getElementById('modalPersonalizacaoTitle').textContent = `Personalizar ${produtoSelecionado.nome}`;
            
            let html = '';
            dados.opcoes.forEach(opcao => {
                html += `<label style="display: flex; align-items: center; gap: 0.5rem; margin: 0.5rem 0; cursor: pointer;">
                    <input type="checkbox" value="${opcao.id}" class="opcao-checkbox">
                    <span>${opcao.nome}</span>
                    <span style="color: #22c55e; margin-left: auto;">${opcao.preco > 0 ? '+R$ ' + opcao.preco.toFixed(2) : 'Gr√°tis'}</span>
                </label>`;
            });
            document.getElementById('opcoesContainer').innerHTML = html;
            document.getElementById('observacoes').value = '';
            abrirModal('modalPersonalizacao');
        }

        function salvarPersonalizacao() {
            const checkboxes = document.querySelectorAll('.opcao-checkbox:checked');
            const opcoes = [];
            let precoAdicional = 0;

            checkboxes.forEach(cb => {
                const opcao = dados.opcoes.find(o => o.id == cb.value);
                opcoes.push(opcao);
                precoAdicional += opcao.preco;
            });

            const observacoes = document.getElementById('observacoes').value;
            const item = {
                produto: produtoSelecionado,
                opcoes: opcoes,
                observacoes: observacoes,
                preco: produtoSelecionado.preco + precoAdicional
            };

            dados.carrinho.push(item);
            salvarDados();
            fecharModal('modalPersonalizacao');
            atualizarUI();
        }

        function removerDoCarrinho(index) {
            dados.carrinho.splice(index, 1);
            salvarDados();
            atualizarUI();
        }

        function limparCarrinho() {
            dados.carrinho = [];
            document.getElementById('nomeCliente').value = '';
            document.getElementById('telefoneCliente').value = '';
            atualizarUI();
        }

        function finalizarVenda() {
            if (dados.carrinho.length === 0) {
                alert('Carrinho vazio!');
                return;
            }
            if (!document.getElementById('nomeCliente').value) {
                alert('Informe o nome do cliente!');
                return;
            }
            abrirModal('modalPagamento');
        }

        function finalizarComPagamento(metodo) {
            const cliente = document.getElementById('nomeCliente').value;
            const telefone = document.getElementById('telefoneCliente').value;
            const total = dados.carrinho.reduce((sum, item) => sum + item.preco, 0);
            
            dados.vendas.push({
                id: dados.vendas.length + 1,
                cliente,
                telefone,
                itens: dados.carrinho,
                total,
                metodo,
                hora: new Date().toLocaleTimeString(),
                status: 'concluida'
            });
            
            dados.pedidos.push({
                id: dados.vendas.length,
                cliente,
                telefone,
                itens: dados.carrinho,
                status: 'pendente',
                tempo: 0
            });
            
            salvarDados();
            fecharModal('modalPagamento');
            
            document.getElementById('sucessoMsg').innerHTML = `Pedido #${dados.vendas.length}<br>Total: R$ ${total.toFixed(2)}`;
            abrirModal('modalSucesso');
            
            setTimeout(() => {
                limparCarrinho();
                atualizarUI();
            }, 2000);
        }

        function adicionarProduto() {
            const nome = document.getElementById('nomeProduto').value;
            const preco = parseFloat(document.getElementById('precoProduto').value);
            if (nome && preco) {
                dados.produtos.push({ id: Date.now(), nome, preco });
                salvarDados();
                fecharModal('modalProduto');
                document.getElementById('nomeProduto').value = '';
                document.getElementById('precoProduto').value = '';
                atualizarUI();
            }
        }

        function adicionarIngrediente() {
            const nome = document.getElementById('nomeIngrediente').value;
            const quantidade = parseFloat(document.getElementById('quantidadeIngrediente').value);
            const unidade = document.getElementById('unidadeIngrediente').value;
            if (nome && quantidade && unidade) {
                dados.estoque.push({ id: Date.now(), nome, quantidade, unidade });
                salvarDados();
                fecharModal('modalEstoque');
                document.getElementById('nomeIngrediente').value = '';
                document.getElementById('quantidadeIngrediente').value = '';
                document.getElementById('unidadeIngrediente').value = '';
                atualizarUI();
            }
        }

        function adicionarDespesa() {
            const nome = document.getElementById('nomeDespesa').value;
            const quantidade = parseFloat(document.getElementById('quantidadeDespesa').value);
            const unidade = document.getElementById('unidadeDespesa').value;
            const valor = parseFloat(document.getElementById('valorDespesa').value);
            if (nome && quantidade && unidade && valor) {
                const custoUnitario = valor / quantidade;
                dados.despesas.push({ id: Date.now(), nome, quantidade, unidade, valor, custoUnitario });
                salvarDados();
                fecharModal('modalDespesa');
                document.getElementById('nomeDespesa').value = '';
                document.getElementById('quantidadeDespesa').value = '';
                document.getElementById('unidadeDespesa').value = '';
                document.getElementById('valorDespesa').value = '';
                atualizarUI();
            }
        }

        function adicionarCombo() {
            const nome = document.getElementById('nomeCombo').value;
            const preco = parseFloat(document.getElementById('precoCombo').value);
            const produtos = document.getElementById('produtosCombo').value;
            if (nome && preco && produtos) {
                dados.combos.push({ id: Date.now(), nome, preco, produtos });
                salvarDados();
                fecharModal('modalCombos');
                document.getElementById('nomeCombo').value = '';
                document.getElementById('precoCombo').value = '';
                document.getElementById('produtosCombo').value = '';
                atualizarUI();
            }
        }

        function deletarProduto(id) {
            dados.produtos = dados.produtos.filter(p => p.id !== id);
            salvarDados();
            atualizarUI();
        }

        function deletarIngrediente(id) {
            dados.estoque = dados.estoque.filter(i => i.id !== id);
            salvarDados();
            atualizarUI();
        }

        function deletarDespesa(id) {
            dados.despesas = dados.despesas.filter(d => d.id !== id);
            salvarDados();
            atualizarUI();
        }

        function deletarCombo(id) {
            dados.combos = dados.combos.filter(c => c.id !== id);
            salvarDados();
            atualizarUI();
        }

        function marcarPronto(pedidoId) {
            const pedido = dados.pedidos.find(p => p.id === pedidoId);
            if (pedido) pedido.status = 'pronto';
            salvarDados();
            atualizarUI();
        }

        function cancelarPedido(pedidoId) {
            dados.pedidos = dados.pedidos.filter(p => p.id !== pedidoId);
            salvarDados();
            atualizarUI();
        }

        function atualizarUI() {
            // Dashboard
            const faturamento = dados.vendas.filter(v => v.status === 'concluida').reduce((sum, v) => sum + v.total, 0);
            const lucro = faturamento * 0.30;
            document.getElementById('dashFaturamento').textContent = `R$ ${faturamento.toFixed(2)}`;
            document.getElementById('dashLucro').textContent = `R$ ${lucro.toFixed(2)}`;

            let html = '';
            dados.vendas.filter(v => v.status === 'concluida').forEach(venda => {
                html += `<tr>
                    <td>#${venda.id}</td>
                    <td>${venda.cliente}</td>
                    <td>R$ ${venda.total.toFixed(2)}</td>
                    <td>${venda.hora}</td>
                </tr>`;
            });
            document.getElementById('dashHistorico').innerHTML = html || '<tr><td colspan="4" style="text-align: center;">Nenhuma venda</td></tr>';

            // Vendas
            html = '';
            dados.produtos.forEach(produto => {
                html += `<div class="product-card" onclick="adicionarProdutoAoCarrinho(${produto.id})">
                    <div class="product-name">${produto.nome}</div>
                    <div class="product-price">R$ ${produto.preco.toFixed(2)}</div>
                </div>`;
            });
            document.getElementById('produtosVendas').innerHTML = html;

            html = '';
            dados.carrinho.forEach((item, index) => {
                const opcoes = item.opcoes.map(o => o.nome).join(', ');
                html += `<div class="cart-item">
                    <div class="cart-item-name">${item.produto.nome}</div>
                    ${opcoes ? `<div class="cart-item-options">${opcoes}</div>` : ''}
                    <div style="display: flex; justify-content: space-between; margin-top: 0.5rem;">
                        <div>R$ ${item.preco.toFixed(2)}</div>
                        <button class="btn-danger" onclick="removerDoCarrinho(${index})">‚úï</button>
                    </div>
                </div>`;
            });
            document.getElementById('carrinhoItems').innerHTML = html;
            const total = dados.carrinho.reduce((sum, item) => sum + item.preco, 0);
            document.getElementById('carrinhoTotal').textContent = `R$ ${total.toFixed(2)}`;

            // Combos
            html = '';
            dados.combos.forEach(combo => {
                html += `<tr>
                    <td>${combo.nome}</td>
                    <td>${combo.produtos}</td>
                    <td>R$ ${combo.preco.toFixed(2)}</td>
                    <td><button class="btn-danger" onclick="deletarCombo(${combo.id})">üóëÔ∏è</button></td>
                </tr>`;
            });
            document.getElementById('combosTabela').innerHTML = html || '<tr><td colspan="4" style="text-align: center;">Nenhum combo cadastrado</td></tr>';

            // Cozinha
            html = '';
            dados.pedidos.filter(p => p.status === 'pendente').forEach(pedido => {
                let itens = pedido.itens.map(i => `${i.produto.nome} ${i.opcoes.map(o => o.nome).join(', ')}`).join('<br>');
                html += `<div class="card" style="border-left-color: #ef4444;">
                    <div style="display: flex; justify-content: space-between; margin-bottom: 1rem;">
                        <div><strong>Pedido #${pedido.id}</strong></div>
                        <div style="color: #ef4444; font-weight: bold;">${pedido.cliente}</div>
                    </div>
                    <div style="margin-bottom: 1rem;">${itens}</div>
                    <div style="display: flex; gap: 0.5rem;">
                        <button class="btn-primary" onclick="marcarPronto(${pedido.id})">‚úì PRONTO</button>
                        <button class="btn-danger" onclick="cancelarPedido(${pedido.id})">‚úï Cancelar</button>
                    </div>
                </div>`;
            });
            document.getElementById('cozinhaItems').innerHTML = html || '<div style="color: #94a3b8; text-align: center;">Nenhum pedido</div>';

            // Produtos
            html = '';
            dados.produtos.forEach(produto => {
                html += `<tr>
                    <td>${produto.nome}</td>
                    <td>R$ ${produto.preco.toFixed(2)}</td>
                    <td><button class="btn-danger" onclick="deletarProduto(${produto.id})">üóëÔ∏è</button></td>
                </tr>`;
            });
            document.getElementById('produtosTabela').innerHTML = html || '<tr><td colspan="3" style="text-align: center;">Nenhum produto</td></tr>';

            // Estoque
            html = '';
            dados.estoque.forEach(item => {
                html += `<tr>
                    <td>${item.nome}</td>
                    <td>${item.quantidade}</td>
                    <td>${item.unidade}</td>
                    <td><button class="btn-danger" onclick="deletarIngrediente(${item.id})">üóëÔ∏è</button></td>
                </tr>`;
            });
            document.getElementById('estoqueTabela').innerHTML = html || '<tr><td colspan="4" style="text-align: center;">Nenhum ingrediente</td></tr>';

            // Despesas
            html = '';
            dados.despesas.forEach(despesa => {
                html += `<tr>
                    <td>${despesa.nome}</td>
                    <td>${despesa.quantidade}</td>
                    <td>${despesa.unidade}</td>
                    <td>R$ ${despesa.valor.toFixed(2)}</td>
                    <td>R$ ${despesa.custoUnitario.toFixed(4)}/${despesa.unidade}</td>
                    <td><button class="btn-danger" onclick="deletarDespesa(${despesa.id})">üóëÔ∏è</button></td>
                </tr>`;
            });
            document.getElementById('despesasTable').innerHTML = html || '<tr><td colspan="6" style="text-align: center;">Nenhum ingrediente cadastrado</td></tr>';

            // Relat√≥rios (APENAS vendas conclu√≠das)
            html = '';
            dados.vendas.filter(v => v.status === 'concluida').forEach(venda => {
                const produtos = venda.itens.map(i => i.produto.nome).join(', ');
                html += `<tr>
                    <td>#${venda.id}</td>
                    <td>${venda.cliente}</td>
                    <td>${venda.telefone}</td>
                    <td>${produtos}</td>
                    <td>R$ ${venda.total.toFixed(2)}</td>
                    <td>${venda.hora}</td>
                </tr>`;
            });
            document.getElementById('relatoriosTabela').innerHTML = html || '<tr><td colspan="6" style="text-align: center;">Nenhuma venda</td></tr>';
        }

        function exportarPDF() {
            const element = document.getElementById('relatoriosTabela').parentElement.parentElement;
            const opt = {
                margin: 10,
                filename: 'relatorio_vendas.pdf',
                image: { type: 'jpeg', quality: 0.98 },
                html2canvas: { scale: 2 },
                jsPDF: { orientation: 'landscape' }
            };
            html2pdf().set(opt).from(element).save();
        }

        function exportarExcel() {
            const table = document.getElementById('relatoriosTabela').parentElement.parentElement;
            const ws = XLSX.utils.table_to_sheet(table);
            const wb = XLSX.utils.book_new();
            XLSX.utils.book_append_sheet(wb, ws, 'Vendas');
            XLSX.writeFile(wb, 'relatorio_vendas.xlsx');
        }

        // Inicializar
        carregarDados();
        mostrarSecao('dashboard');
        atualizarUI();
    </script>
</body>
</html>
