<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Food Truck Manager Pro</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.min.js"></script>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { background: #0f172a; color: #e2e8f0; font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; }
        .navbar { background: linear-gradient(135deg, #1e293b 0%, #0f172a 100%); border-bottom: 3px solid #ff8c00; padding: 1rem 2rem; display: flex; gap: 1rem; align-items: center; flex-wrap: wrap; }
        .navbar button { padding: 0.5rem 1rem; border: none; border-radius: 0.5rem; cursor: pointer; font-weight: 600; transition: all 0.3s; font-size: 0.9rem; }
        .navbar button.active { background: #ff8c00; color: white; }
        .navbar button:not(.active) { background: #334155; color: #cbd5e1; }
        .navbar button:hover { transform: translateY(-2px); }
        .container { padding: 2rem; }
        .card { background: #1e293b; border-radius: 1rem; padding: 1.5rem; margin-bottom: 1rem; border-left: 4px solid #ff8c00; }
        .modal { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.8); z-index: 1000; justify-content: center; align-items: center; }
        .modal.active { display: flex; }
        .modal-content { background: #1e293b; border-radius: 1rem; padding: 2rem; max-width: 600px; width: 90%; border: 2px solid #ff8c00; max-height: 85vh; overflow-y: auto; }
        .modal-title { font-size: 1.5rem; font-weight: bold; color: #ff8c00; margin-bottom: 1rem; }
        .option-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 1rem; margin: 1.5rem 0; }
        .option-item { background: #0f172a; padding: 1rem; border-radius: 0.5rem; border: 2px solid #334155; cursor: pointer; transition: all 0.3s; display: flex; align-items: center; gap: 0.75rem; }
        .option-item:hover { border-color: #ff8c00; background: #1a2332; }
        .option-item input[type="checkbox"] { cursor: pointer; width: 18px; height: 18px; accent-color: #ff8c00; }
        .option-label { flex: 1; }
        .option-price { color: #22c55e; font-weight: bold; font-size: 0.9rem; }
        .btn-primary { background: #ff8c00; color: white; padding: 0.75rem 1.5rem; border: none; border-radius: 0.5rem; cursor: pointer; font-weight: 600; transition: all 0.3s; }
        .btn-primary:hover { background: #e67e00; transform: translateY(-2px); }
        .btn-secondary { background: #64748b; color: white; padding: 0.75rem 1.5rem; border: none; border-radius: 0.5rem; cursor: pointer; font-weight: 600; }
        .btn-secondary:hover { background: #475569; }
        .btn-danger { background: #ef4444; color: white; padding: 0.5rem 1rem; border: none; border-radius: 0.5rem; cursor: pointer; }
        .btn-danger:hover { background: #dc2626; }
        .product-card { background: #1e293b; border: 2px solid #334155; padding: 1.5rem; border-radius: 0.75rem; cursor: pointer; transition: all 0.3s; margin-bottom: 1rem; }
        .product-card:hover { border-color: #ff8c00; transform: translateY(-2px); }
        .product-name { font-size: 1.1rem; font-weight: 600; margin-bottom: 0.5rem; }
        .product-price { color: #ff8c00; font-size: 1.2rem; font-weight: bold; }
        .cart-item { background: #0f172a; padding: 1rem; border-radius: 0.5rem; margin-bottom: 0.5rem; border-left: 3px solid #ff8c00; }
        .cart-item-name { font-weight: 600; margin-bottom: 0.25rem; }
        .cart-item-options { color: #fbbf24; font-size: 0.9rem; margin-left: 1rem; }
        .total-box { background: linear-gradient(135deg, #1e293b 0%, #0f172a 100%); border: 2px solid #22c55e; padding: 1rem; border-radius: 0.75rem; margin-top: 1rem; }
        .total-value { color: #22c55e; font-size: 1.5rem; font-weight: bold; }
        .grid-2 { display: grid; grid-template-columns: 1fr 1fr; gap: 2rem; }
        .section-title { font-size: 1.3rem; font-weight: bold; color: #ff8c00; margin-bottom: 1rem; }
        table { width: 100%; border-collapse: collapse; }
        th { background: #334155; padding: 0.75rem; text-align: left; font-weight: 600; border-bottom: 2px solid #ff8c00; }
        td { padding: 0.75rem; border-bottom: 1px solid #334155; }
        tr:hover { background: #1e293b; }
        textarea { width: 100%; padding: 0.75rem; background: #0f172a; border: 1px solid #334155; border-radius: 0.5rem; color: white; margin: 1rem 0; font-family: inherit; }
        textarea::placeholder { color: #64748b; }
        input[type="text"], input[type="number"], input[type="tel"], select { width: 100%; padding: 0.75rem; background: #0f172a; border: 1px solid #334155; border-radius: 0.5rem; color: white; margin-bottom: 1rem; }
        input::placeholder { color: #64748b; }
        select { cursor: pointer; }
        @media (max-width: 768px) {
            .grid-2 { grid-template-columns: 1fr; }
            .navbar { padding: 1rem; }
            .navbar button { padding: 0.4rem 0.8rem; font-size: 0.8rem; }
        }
    </style>
</head>
<body>
    <!-- NAVBAR -->
    <div class="navbar">
        <span style="font-size: 1.5rem; font-weight: bold; color: #ff8c00;">üçî Food Truck Manager</span>
        <button class="active" onclick="mostrarSecao('dashboard')">üìä Dashboard</button>
        <button onclick="mostrarSecao('vendas')">üõí Vendas</button>
        <button onclick="mostrarSecao('cozinha')">üë®‚Äçüç≥ Cozinha</button>
        <button onclick="mostrarSecao('produtos')">üì¶ Produtos</button>
        <button onclick="mostrarSecao('estoque')">üìã Estoque</button>
        <button onclick="mostrarSecao('despesas')">üí∞ Despesas</button>
        <button onclick="mostrarSecao('relatorios')">üìä Relat√≥rios</button>
    </div>

    <!-- DASHBOARD -->
    <div id="dashboard" class="container">
        <h1 class="section-title">üìä Dashboard</h1>
        <div class="grid-2">
            <div class="card">
                <div style="color: #ff8c00;">Faturamento</div>
                <div style="font-size: 2rem; font-weight: bold; color: #ff8c00;" id="dashFaturamento">R$ 0,00</div>
            </div>
            <div class="card">
                <div style="color: #22c55e;">Lucro L√≠quido</div>
                <div style="font-size: 2rem; font-weight: bold; color: #22c55e;" id="dashLucro">R$ 0,00</div>
            </div>
        </div>
        <div class="card">
            <div class="section-title">üìã Hist√≥rico de Vendas</div>
            <table>
                <thead>
                    <tr>
                        <th>#</th>
                        <th>Cliente</th>
                        <th>Total</th>
                        <th>Hora</th>
                    </tr>
                </thead>
                <tbody id="dashHistorico">
                    <tr><td colspan="4" style="text-align: center;">Nenhuma venda</td></tr>
                </tbody>
            </table>
        </div>
    </div>

    <!-- VENDAS -->
    <div id="vendas" class="container" style="display: none;">
        <h1 class="section-title">üõí Vendas</h1>
        <div class="grid-2">
            <div>
                <div class="section-title">Produtos</div>
                <div id="produtosGrid"></div>
            </div>
            <div>
                <div class="section-title">üõí Carrinho</div>
                <input type="text" id="nomeCliente" placeholder="Nome do Cliente" style="margin-bottom: 0.5rem;">
                <input type="tel" id="telefoneCliente" placeholder="Telefone (11 99999-9999)" style="margin-bottom: 1rem;">
                <div id="carrinhoItems" style="max-height: 250px; overflow-y: auto;">
                    <div style="color: #94a3b8; text-align: center;">Carrinho vazio</div>
                </div>
                <div class="total-box">
                    <div>Total:</div>
                    <div class="total-value" id="carrinhoTotal">R$ 0,00</div>
                </div>
                <button class="btn-primary" onclick="finalizarVenda()" style="width: 100%; margin-top: 1rem;">Finalizar Venda</button>
            </div>
        </div>
    </div>

    <!-- COZINHA -->
    <div id="cozinha" class="container" style="display: none;">
        <h1 class="section-title">üë®‚Äçüç≥ Cozinha</h1>
        <div id="cozinhaItems" style="display: grid; grid-template-columns: repeat(auto-fill, minmax(300px, 1fr)); gap: 1rem;"></div>
    </div>

    <!-- PRODUTOS -->
    <div id="produtos" class="container" style="display: none;">
        <h1 class="section-title">üì¶ Produtos</h1>
        <button class="btn-primary" onclick="abrirModalProduto()" style="margin-bottom: 1rem;">+ Novo Produto</button>
        <table>
            <thead>
                <tr>
                    <th>Nome</th>
                    <th>Pre√ßo</th>
                    <th>A√ß√µes</th>
                </tr>
            </thead>
            <tbody id="produtosTabela">
                <tr><td colspan="3" style="text-align: center;">Nenhum produto</td></tr>
            </tbody>
        </table>
    </div>

    <!-- ESTOQUE -->
    <div id="estoque" class="container" style="display: none;">
        <h1 class="section-title">üìã Estoque</h1>
        <button class="btn-primary" onclick="abrirModalIngrediente()" style="margin-bottom: 1rem;">+ Novo Ingrediente</button>
        <table>
            <thead>
                <tr>
                    <th>Ingrediente</th>
                    <th>Quantidade</th>
                    <th>Pre√ßo Unit√°rio</th>
                    <th>A√ß√µes</th>
                </tr>
            </thead>
            <tbody id="estoqueTabela">
                <tr><td colspan="4" style="text-align: center;">Nenhum ingrediente</td></tr>
            </tbody>
        </table>
    </div>

    <!-- DESPESAS -->
    <div id="despesas" class="container" style="display: none;">
        <h1 class="section-title">üí∞ Despesas</h1>
        <button class="btn-primary" onclick="abrirModalDespesa()" style="margin-bottom: 1rem;">+ Novo Ingrediente</button>
        <table>
            <thead>
                <tr>
                    <th>Ingrediente</th>
                    <th>Quantidade</th>
                    <th>Unidade</th>
                    <th>Valor Pago</th>
                    <th>Custo Unit√°rio</th>
                    <th>A√ß√µes</th>
                </tr>
            </thead>
            <tbody id="despesasTable">
                <tr><td colspan="6" style="text-align: center;">Nenhum ingrediente cadastrado</td></tr>
            </tbody>
        </table>
    </div>

    <!-- RELAT√ìRIOS -->
    <div id="relatorios" class="container" style="display: none;">
        <h1 class="section-title">üìä Relat√≥rios</h1>
        <div style="margin-bottom: 1rem; display: flex; gap: 10px;">
            <button class="btn-primary" onclick="exportarPDF()" style="background: #10b981;">üì• Baixar PDF</button>
            <button class="btn-primary" onclick="exportarExcel()" style="background: #3b82f6;">üìä Baixar Excel</button>
        </div>
        <table>
            <thead>
                <tr>
                    <th>#</th>
                    <th>Cliente</th>
                    <th>Telefone</th>
                    <th>Produtos</th>
                    <th>Total</th>
                    <th>Hora</th>
                </tr>
            </thead>
            <tbody id="relatoriosTabela">
                <tr><td colspan="6" style="text-align: center;">Nenhuma venda</td></tr>
            </tbody>
        </table>
    </div>

    <!-- MODAL PERSONALIZA√á√ÉO -->
    <div id="modalPersonalizacao" class="modal">
        <div class="modal-content">
            <div class="modal-title" id="modalTitulo">Personalizar Produto</div>
            <div class="option-grid" id="opcoesGrid" style="min-height: 100px;"></div>
            <div style="margin-top: 1.5rem;">
                <label style="color: #cbd5e1; display: block; margin-bottom: 0.5rem; font-weight: 600;">üìù Observa√ß√µes Adicionais:</label>
                <textarea id="observacoes" placeholder="Ex: Sem cebola, muito temperado..." rows="3"></textarea>
            </div>
            <div style="display: flex; gap: 1rem; justify-content: flex-end;">
                <button class="btn-secondary" onclick="fecharModal('modalPersonalizacao')">Cancelar</button>
                <button class="btn-primary" onclick="adicionarAoCarrinho()">Salvar Altera√ß√µes</button>
            </div>
        </div>
    </div>

    <!-- MODAL NOVO PRODUTO -->
    <div id="modalProduto" class="modal">
        <div class="modal-content">
            <div class="modal-title">Novo Produto</div>
            <input type="text" id="prodNome" placeholder="Nome do Produto">
            <input type="number" id="prodPreco" placeholder="Pre√ßo" step="0.01">
            <div style="display: flex; gap: 1rem; justify-content: flex-end;">
                <button class="btn-secondary" onclick="fecharModal('modalProduto')">Cancelar</button>
                <button class="btn-primary" onclick="salvarProduto()">Salvar</button>
            </div>
        </div>
    </div>

    <!-- MODAL NOVO INGREDIENTE -->
    <div id="modalIngrediente" class="modal">
        <div class="modal-content">
            <div class="modal-title">Novo Ingrediente</div>
            <input type="text" id="ingNome" placeholder="Nome do Ingrediente">
            <input type="number" id="ingQtd" placeholder="Quantidade" step="0.01">
            <input type="number" id="ingPreco" placeholder="Pre√ßo Unit√°rio" step="0.01">
            <div style="display: flex; gap: 1rem; justify-content: flex-end;">
                <button class="btn-secondary" onclick="fecharModal('modalIngrediente')">Cancelar</button>
                <button class="btn-primary" onclick="salvarIngrediente()">Salvar</button>
            </div>
        </div>
    </div>

    <!-- MODAL PAGAMENTO -->
    <div id="modalPagamento" class="modal">
        <div class="modal-content">
            <div class="modal-title">M√©todo de Pagamento</div>
            <div class="option-grid">
                <button class="option-item" onclick="finalizarComPagamento('Dinheiro')" style="border: 2px solid #3b82f6; background: #1e293b; padding: 1rem; border-radius: 0.5rem; cursor: pointer; color: white; font-weight: 600; justify-content: center;">üíµ Dinheiro</button>
                <button class="option-item" onclick="finalizarComPagamento('D√©bito')" style="border: 2px solid #ff8c00; background: #1e293b; padding: 1rem; border-radius: 0.5rem; cursor: pointer; color: white; font-weight: 600; justify-content: center;">üèß D√©bito</button>
                <button class="option-item" onclick="finalizarComPagamento('Cr√©dito')" style="border: 2px solid #a855f7; background: #1e293b; padding: 1rem; border-radius: 0.5rem; cursor: pointer; color: white; font-weight: 600; justify-content: center;">üí≥ Cr√©dito</button>
                <button class="option-item" onclick="finalizarComPagamento('PIX')" style="border: 2px solid #22c55e; background: #1e293b; padding: 1rem; border-radius: 0.5rem; cursor: pointer; color: white; font-weight: 600; justify-content: center;">üì± PIX</button>
            </div>
            <button class="btn-secondary" onclick="fecharModal('modalPagamento')" style="width: 100%;">Cancelar</button>
        </div>
    </div>

    <!-- MODAL SUCESSO -->
    <div id="modalSucesso" class="modal">
        <div class="modal-content" style="text-align: center;">
            <div style="font-size: 3rem; margin-bottom: 1rem;">‚úì</div>
            <div class="modal-title">Venda Realizada!</div>
            <div id="sucessoMsg" style="margin: 1rem 0; color: #cbd5e1;"></div>
            <button class="btn-primary" onclick="fecharModal('modalSucesso'); mostrarSecao('vendas'); limparCarrinho();" style="width: 100%;">OK</button>
        </div>
    </div>

    <!-- MODAL DESPESA -->
    <div id="modalDespesa" class="modal">
        <div class="modal-content">
            <div class="modal-title">Novo Ingrediente</div>
            <input type="text" id="despesaNome" placeholder="Nome do Ingrediente (ex: Carne)">
            <input type="number" id="despesaQtd" placeholder="Quantidade Comprada" step="0.01">
            <select id="despesaUnidade">
                <option value="kg">kg (Quilograma)</option>
                <option value="g">g (Grama)</option>
                <option value="L">L (Litro)</option>
                <option value="ml">ml (Mililitro)</option>
                <option value="un">un (Unidade)</option>
            </select>
            <input type="number" id="despesaValor" placeholder="Valor Pago (R$)" step="0.01">
            <div style="display: flex; gap: 1rem; justify-content: flex-end;">
                <button class="btn-secondary" onclick="fecharModal('modalDespesa')">Cancelar</button>
                <button class="btn-primary" onclick="salvarDespesa()">Salvar</button>
            </div>
        </div>
    </div>

    <script>
        // DADOS
        let dados = {
            produtos: [
                { id: 1, nome: 'Hamburguer Cl√°ssico', preco: 25.00 },
                { id: 2, nome: 'Hamburguer Especial', preco: 35.00 },
                { id: 3, nome: 'Sandu√≠che de Frango', preco: 28.00 }
            ],
            ingredientes: [],
            vendas: [],
            pedidos: [],
            carrinho: [],
            despesas: [],
            opcoes: [
                { id: 1, nome: 'Sem Queijo', preco: 0 },
                { id: 2, nome: 'Com Queijo', preco: 0 },
                { id: 3, nome: 'Queijo Extra', preco: 3 },
                { id: 4, nome: 'Bacon Extra', preco: 4 },
                { id: 5, nome: 'Maionese Temperada', preco: 2 },
                { id: 6, nome: 'Farofa', preco: 1.50 },
                { id: 7, nome: 'Alface', preco: 0 },
                { id: 8, nome: 'Tomate', preco: 0 }
            ]
        };
        
        let produtoSelecionado = null;
        let opcoesSelecionadas = [];

        // CARREGAR DADOS
        function carregarDados() {
            const saved = localStorage.getItem('foodTruckData');
            if (saved) {
                try {
                    const loaded = JSON.parse(saved);
                    dados = { ...dados, ...loaded };
                } catch (e) {
                    console.error('Erro ao carregar dados:', e);
                }
            }
            if (!dados.opcoes || dados.opcoes.length === 0) {
                dados.opcoes = [
                    { id: 1, nome: 'Sem Queijo', preco: 0 },
                    { id: 2, nome: 'Com Queijo', preco: 0 },
                    { id: 3, nome: 'Queijo Extra', preco: 3 },
                    { id: 4, nome: 'Bacon Extra', preco: 4 },
                    { id: 5, nome: 'Maionese Temperada', preco: 2 },
                    { id: 6, nome: 'Farofa', preco: 1.50 },
                    { id: 7, nome: 'Alface', preco: 0 },
                    { id: 8, nome: 'Tomate', preco: 0 }
                ];
            }
            if (!dados.despesas) dados.despesas = [];
            atualizarUI();
        }

        // SALVAR DADOS
        function salvarDados() {
            localStorage.setItem('foodTruckData', JSON.stringify(dados));
        }

        // MOSTRAR SE√á√ÉO
        function mostrarSecao(secao) {
            document.querySelectorAll('[id]').forEach(el => {
                if (['dashboard', 'vendas', 'cozinha', 'produtos', 'estoque', 'despesas', 'relatorios'].includes(el.id)) {
                    el.style.display = 'none';
                }
            });
            document.getElementById(secao).style.display = 'block';
            document.querySelectorAll('.navbar button').forEach(btn => btn.classList.remove('active'));
            event.target.classList.add('active');
            atualizarUI();
        }

        // MODAL
        function abrirModal(id) { 
            document.getElementById(id).classList.add('active'); 
        }
        function fecharModal(id) { 
            document.getElementById(id).classList.remove('active'); 
        }

        // PRODUTOS
        function abrirModalProduto() {
            document.getElementById('prodNome').value = '';
            document.getElementById('prodPreco').value = '';
            abrirModal('modalProduto');
        }

        function salvarProduto() {
            const nome = document.getElementById('prodNome').value;
            const preco = parseFloat(document.getElementById('prodPreco').value);
            if (!nome || !preco) { alert('Preencha todos os campos'); return; }
            dados.produtos.push({ id: Date.now(), nome, preco });
            salvarDados();
            fecharModal('modalProduto');
            atualizarUI();
        }

        // INGREDIENTES
        function abrirModalIngrediente() {
            document.getElementById('ingNome').value = '';
            document.getElementById('ingQtd').value = '';
            document.getElementById('ingPreco').value = '';
            abrirModal('modalIngrediente');
        }

        function salvarIngrediente() {
            const nome = document.getElementById('ingNome').value;
            const qtd = parseFloat(document.getElementById('ingQtd').value);
            const preco = parseFloat(document.getElementById('ingPreco').value);
            if (!nome || !qtd || !preco) { alert('Preencha todos os campos'); return; }
            dados.ingredientes.push({ id: Date.now(), nome, qtd, preco });
            salvarDados();
            fecharModal('modalIngrediente');
            atualizarUI();
        }

        // DESPESAS
        function abrirModalDespesa() {
            document.getElementById('despesaNome').value = '';
            document.getElementById('despesaQtd').value = '';
            document.getElementById('despesaValor').value = '';
            document.getElementById('despesaUnidade').value = 'kg';
            abrirModal('modalDespesa');
        }

        function salvarDespesa() {
            const nome = document.getElementById('despesaNome').value;
            const qtd = parseFloat(document.getElementById('despesaQtd').value);
            const unidade = document.getElementById('despesaUnidade').value;
            const valor = parseFloat(document.getElementById('despesaValor').value);
            
            if (!nome || !qtd || !valor) { alert('Preencha todos os campos'); return; }
            
            const custoUnitario = valor / qtd;
            dados.despesas.push({ id: Date.now(), nome, qtd, unidade, valor, custoUnitario });
            salvarDados();
            fecharModal('modalDespesa');
            atualizarUI();
        }

        function deletarDespesa(id) {
            if (confirm('Tem certeza?')) {
                dados.despesas = dados.despesas.filter(d => d.id !== id);
                salvarDados();
                atualizarUI();
            }
        }

        // VENDAS - PERSONALIZA√á√ÉO
        function abrirPersonalizacao(produtoId) {
            produtoSelecionado = dados.produtos.find(p => p.id === produtoId);
            if (!produtoSelecionado) {
                alert('Produto n√£o encontrado');
                return;
            }
            opcoesSelecionadas = [];
            document.getElementById('modalTitulo').textContent = `Personalizar ${produtoSelecionado.nome}`;
            
            let html = '';
            dados.opcoes.forEach(op => {
                html += `<label class="option-item">
                    <input type="checkbox" onchange="atualizarOpcoes(${op.id}, this.checked)"> 
                    <span class="option-label">${op.nome}</span>
                    <span class="option-price">${op.preco > 0 ? '+R$ ' + op.preco.toFixed(2) : 'Gr√°tis'}</span>
                </label>`;
            });
            document.getElementById('opcoesGrid').innerHTML = html;
            document.getElementById('observacoes').value = '';
            abrirModal('modalPersonalizacao');
        }

        function atualizarOpcoes(opId, isChecked) {
            const op = dados.opcoes.find(o => o.id === opId);
            if (!op) return;
            
            if (isChecked) {
                if (!opcoesSelecionadas.find(o => o.id === opId)) {
                    opcoesSelecionadas.push(op);
                }
            } else {
                opcoesSelecionadas = opcoesSelecionadas.filter(o => o.id !== opId);
            }
        }

        function adicionarAoCarrinho() {
            if (!produtoSelecionado) {
                alert('Nenhum produto selecionado');
                return;
            }
            
            const precoOpcoes = opcoesSelecionadas.reduce((sum, op) => sum + op.preco, 0);
            const precoTotal = produtoSelecionado.preco + precoOpcoes;
            const observacoes = document.getElementById('observacoes').value;
            
            dados.carrinho.push({
                id: Date.now(),
                produto: produtoSelecionado,
                opcoes: opcoesSelecionadas,
                preco: precoTotal,
                observacoes
            });
            
            fecharModal('modalPersonalizacao');
            atualizarUI();
        }

        function removerDoCarrinho(itemId) {
            dados.carrinho = dados.carrinho.filter(item => item.id !== itemId);
            salvarDados();
            atualizarUI();
        }

        function limparCarrinho() {
            dados.carrinho = [];
            document.getElementById('nomeCliente').value = '';
            document.getElementById('telefoneCliente').value = '';
            atualizarUI();
        }

        function finalizarVenda() {
            if (dados.carrinho.length === 0) { alert('Carrinho vazio'); return; }
            if (!document.getElementById('nomeCliente').value) { alert('Preencha o nome do cliente'); return; }
            abrirModal('modalPagamento');
        }

        function finalizarComPagamento(metodo) {
            const cliente = document.getElementById('nomeCliente').value;
            const telefone = document.getElementById('telefoneCliente').value;
            const total = dados.carrinho.reduce((sum, item) => sum + item.preco, 0);
            
            dados.vendas.push({
                id: dados.vendas.length + 1,
                cliente,
                telefone,
                itens: dados.carrinho,
                total,
                metodo,
                hora: new Date().toLocaleTimeString()
            });
            
            dados.pedidos.push({
                id: dados.vendas.length,
                cliente,
                telefone,
                itens: dados.carrinho,
                status: 'pendente',
                tempo: 0
            });
            
            salvarDados();
            fecharModal('modalPagamento');
            
            document.getElementById('sucessoMsg').innerHTML = `Pedido #${dados.vendas.length}<br>Total: R$ ${total.toFixed(2)}`;
            abrirModal('modalSucesso');
        }

        // UI
        function atualizarUI() {
            // Produtos
            let html = '';
            dados.produtos.forEach(prod => {
                html += `<div class="product-card" onclick="abrirPersonalizacao(${prod.id})">
                    <div class="product-name">${prod.nome}</div>
                    <div class="product-price">R$ ${prod.preco.toFixed(2)}</div>
                </div>`;
            });
            document.getElementById('produtosGrid').innerHTML = html || '<div style="color: #94a3b8;">Nenhum produto cadastrado</div>';

            // Carrinho
            html = '';
            let total = 0;
            dados.carrinho.forEach(item => {
                total += item.preco;
                let opcoes = item.opcoes.map(o => o.nome).join(', ');
                html += `<div class="cart-item">
                    <div class="cart-item-name">${item.produto.nome}</div>
                    ${opcoes ? `<div class="cart-item-options">+ ${opcoes}</div>` : ''}
                    ${item.observacoes ? `<div class="cart-item-options">üìù ${item.observacoes}</div>` : ''}
                    <div style="display: flex; justify-content: space-between; margin-top: 0.5rem;">
                        <div>R$ ${item.preco.toFixed(2)}</div>
                        <button class="btn-danger" onclick="removerDoCarrinho(${item.id})">‚úï</button>
                    </div>
                </div>`;
            });
            document.getElementById('carrinhoItems').innerHTML = html || '<div style="color: #94a3b8; text-align: center;">Carrinho vazio</div>';
            document.getElementById('carrinhoTotal').textContent = `R$ ${total.toFixed(2)}`;

            // Produtos Tabela
            html = '';
            dados.produtos.forEach(prod => {
                html += `<tr>
                    <td>${prod.nome}</td>
                    <td>R$ ${prod.preco.toFixed(2)}</td>
                    <td><button class="btn-danger" onclick="deletarProduto(${prod.id})">üóëÔ∏è</button></td>
                </tr>`;
            });
            document.getElementById('produtosTabela').innerHTML = html || '<tr><td colspan="3" style="text-align: center;">Nenhum produto</td></tr>';

            // Estoque
            html = '';
            dados.ingredientes.forEach(ing => {
                html += `<tr>
                    <td>${ing.nome}</td>
                    <td>${ing.qtd}</td>
                    <td>R$ ${ing.preco.toFixed(2)}</td>
                    <td><button class="btn-danger" onclick="deletarIngrediente(${ing.id})">üóëÔ∏è</button></td>
                </tr>`;
            });
            document.getElementById('estoqueTabela').innerHTML = html || '<tr><td colspan="4" style="text-align: center;">Nenhum ingrediente</td></tr>';

            // Despesas
            html = '';
            if (dados.despesas && dados.despesas.length > 0) {
                dados.despesas.forEach(desp => {
                    html += `<tr>
                        <td>${desp.nome}</td>
                        <td>${desp.qtd.toFixed(2)}</td>
                        <td>${desp.unidade}</td>
                        <td>R$ ${desp.valor.toFixed(2)}</td>
                        <td>R$ ${desp.custoUnitario.toFixed(4)}/${desp.unidade}</td>
                        <td><button class="btn-danger" onclick="deletarDespesa(${desp.id})">üóëÔ∏è</button></td>
                    </tr>`;
                });
            }
            document.getElementById('despesasTable').innerHTML = html || '<tr><td colspan="6" style="text-align: center;">Nenhum ingrediente cadastrado</td></tr>';

            // Dashboard
            const faturamento = dados.vendas.reduce((sum, v) => sum + v.total, 0);
            document.getElementById('dashFaturamento').textContent = `R$ ${faturamento.toFixed(2)}`;
            document.getElementById('dashLucro').textContent = `R$ ${(faturamento * 0.3).toFixed(2)}`;

            html = '';
            dados.vendas.slice(-5).reverse().forEach(venda => {
                html += `<tr>
                    <td>#${venda.id}</td>
                    <td>${venda.cliente}</td>
                    <td>R$ ${venda.total.toFixed(2)}</td>
                    <td>${venda.hora}</td>
                </tr>`;
            });
            document.getElementById('dashHistorico').innerHTML = html || '<tr><td colspan="4" style="text-align: center;">Nenhuma venda</td></tr>';

            // Relat√≥rios COM TELEFONE
            html = '';
            dados.vendas.forEach(venda => {
                let itens = venda.itens.map(i => i.produto.nome).join(', ');
                html += `<tr>
                    <td>#${venda.id}</td>
                    <td>${venda.cliente}</td>
                    <td>${venda.telefone || '-'}</td>
                    <td>${itens}</td>
                    <td>R$ ${venda.total.toFixed(2)}</td>
                    <td>${venda.hora}</td>
                </tr>`;
            });
            document.getElementById('relatoriosTabela').innerHTML = html || '<tr><td colspan="6" style="text-align: center;">Nenhuma venda</td></tr>';

            // Cozinha
            html = '';
            dados.pedidos.filter(p => p.status === 'pendente').forEach(pedido => {
                let itens = pedido.itens.map(i => `${i.produto.nome} ${i.opcoes.map(o => o.nome).join(', ')}`).join('<br>');
                html += `<div class="card" style="border-left-color: #ef4444;">
                    <div style="display: flex; justify-content: space-between; margin-bottom: 1rem;">
                        <div><strong>Pedido #${pedido.id}</strong></div>
                        <div style="color: #ef4444; font-weight: bold;">${pedido.cliente}</div>
                    </div>
                    <div style="margin-bottom: 1rem;">${itens}</div>
                    <div style="display: flex; gap: 0.5rem;">
                        <button class="btn-primary" onclick="marcarPronto(${pedido.id})">‚úì PRONTO</button>
                        <button class="btn-danger" onclick="cancelarPedido(${pedido.id})">‚úï Cancelar</button>
                    </div>
                </div>`;
            });
            document.getElementById('cozinhaItems').innerHTML = html || '<div style="color: #94a3b8; text-align: center;">Nenhum pedido</div>';
        }

        function deletarProduto(id) {
            dados.produtos = dados.produtos.filter(p => p.id !== id);
            salvarDados();
            atualizarUI();
        }

        function deletarIngrediente(id) {
            dados.ingredientes = dados.ingredientes.filter(i => i.id !== id);
            salvarDados();
            atualizarUI();
        }

        function marcarPronto(id) {
            const pedido = dados.pedidos.find(p => p.id === id);
            if (pedido) pedido.status = 'pronto';
            salvarDados();
            atualizarUI();
        }

        function cancelarPedido(id) {
            dados.pedidos = dados.pedidos.filter(p => p.id !== id);
            salvarDados();
            atualizarUI();
        }

        // EXPORT FUNCTIONS
        function exportarPDF() {
            const element = document.getElementById('relatoriosTabela').parentElement.parentElement;
            const opt = {
                margin: 10,
                filename: 'relatorio_vendas.pdf',
                image: { type: 'jpeg', quality: 0.98 },
                html2canvas: { scale: 2 },
                jsPDF: { orientation: 'landscape', unit: 'mm', format: 'a4' }
            };
            html2pdf().set(opt).from(element).save();
        }

        function exportarExcel() {
            const dados_export = [];
            dados.vendas.forEach(venda => {
                let itens = venda.itens.map(i => i.produto.nome).join(', ');
                dados_export.push({
                    'ID': venda.id,
                    'Cliente': venda.cliente,
                    'Telefone': venda.telefone || '-',
                    'Produtos': itens,
                    'Total': 'R$ ' + venda.total.toFixed(2),
                    'Hora': venda.hora
                });
            });
            
            const ws = XLSX.utils.json_to_sheet(dados_export);
            const wb = XLSX.utils.book_new();
            XLSX.utils.book_append_sheet(wb, ws, 'Vendas');
            XLSX.writeFile(wb, 'relatorio_vendas.xlsx');
        }

        // INICIALIZAR
        carregarDados();
    </script>
</body>
</html>

